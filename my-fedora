#!/bin/bash

# 检测可用的终端模拟器
detect_terminal() {
    # 检查是否在图形环境中
    if [ -z "$DISPLAY" ] && [ -z "$WAYLAND_DISPLAY" ]; then
        echo "none"
        return
    fi
    
    if command -v gnome-terminal &>/dev/null; then
        echo "gnome-terminal"
    elif command -v konsole &>/dev/null; then
        echo "konsole"
    elif command -v xfce4-terminal &>/dev/null; then
        echo "xfce4-terminal"
    elif command -v xterm &>/dev/null; then
        echo "xterm"
    elif command -v tilix &>/dev/null; then
        echo "tilix"
    elif command -v terminator &>/dev/null; then
        echo "terminator"
    elif command -v mate-terminal &>/dev/null; then
        echo "mate-terminal"
    elif command -v lxterminal &>/dev/null; then
        echo "lxterminal"
    else
        echo "none"
    fi
}

# 在新终端中打开容器
TERMINAL=$(detect_terminal)

if [ "$TERMINAL" = "none" ]; then
    # 如果没有图形终端，直接在当前终端运行
    echo "正在进入容器: my-fedora"
    lxc exec my-fedora -- /bin/bash
else
    # 在新终端窗口中打开
    case "$TERMINAL" in
        gnome-terminal)
            gnome-terminal --title="Fedora Container" -- bash -c "lxc exec my-fedora -- /bin/bash" 2>/dev/null &
            ;;
        konsole)
            konsole --title "Fedora Container" -e bash -c "lxc exec my-fedora -- /bin/bash" 2>/dev/null &
            ;;
        xfce4-terminal)
            xfce4-terminal --title="Fedora Container" -e "bash -c \"lxc exec my-fedora -- /bin/bash\"" 2>/dev/null &
            ;;
        tilix)
            tilix --title="Fedora Container" -e "bash -c \"lxc exec my-fedora -- /bin/bash\"" 2>/dev/null &
            ;;
        terminator)
            terminator --title="Fedora Container" -e "bash -c \"lxc exec my-fedora -- /bin/bash\"" 2>/dev/null &
            ;;
        mate-terminal)
            mate-terminal --title="Fedora Container" -e "bash -c \"lxc exec my-fedora -- /bin/bash\"" 2>/dev/null &
            ;;
        lxterminal)
            lxterminal --title="Fedora Container" -e "bash -c \"lxc exec my-fedora -- /bin/bash\"" 2>/dev/null &
            ;;
        xterm)
            xterm -title "Fedora Container" -e bash -c "lxc exec my-fedora -- /bin/bash" 2>/dev/null &
            ;;
    esac
    
    echo "✓ 已在新终端窗口中打开 my-fedora 容器"
fi
